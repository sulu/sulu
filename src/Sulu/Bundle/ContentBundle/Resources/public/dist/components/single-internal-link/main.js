define(["services/suluwebsite/reference-store"],function(a){"use strict";var b={visibleItems:999,instanceName:null,url:"",idsParameter:"ids",preselected:null,idKey:"id",titleKey:"title",resultKey:"",disabledIds:[],translations:{overlayTitle:"single-internal-link.title",noTitle:"public.no-title"}},c="sulu.single-internal-link.",d=function(){return e.call(this,"data-changed")},e=function(a){return c+(this.options.instanceName?this.options.instanceName+".":"")+a},f={skeleton:function(a){return['<div class="single-internal-link container form-element" id="',a.ids.container,'">','   <a class="fa-link icon action choose" href="#" id="',a.ids.button,'"></a>','   <a class="fa-times-circle clear" href="#" id="',a.ids.clearButton,'"></a>','   <input type="text" class="form-element preview-update trigger-save-button" readonly="readonly" id="',a.ids.input,'"/>',"</div>"].join("")},data:function(a){return['<div id="',a.ids.columnNavigation,'" class="data-source-content"/>'].join("")}},g=function(a){return"#"+this.options.ids[a]},h=function(){if(this.options.ids={container:"single-internal-link-"+this.options.instanceName+"-container",input:"single-internal-link-"+this.options.instanceName+"-input",button:"single-internal-link-"+this.options.instanceName+"-button",clearButton:"single-internal-link-"+this.options.instanceName+"-clear-button",columnNavigation:"single-internal-link-"+this.options.instanceName+"-column-navigation"},this.sandbox.dom.html(this.$el,f.skeleton(this.options)),this.$container=this.sandbox.dom.find(g.call(this,"container"),this.$el),this.$input=this.sandbox.dom.find(g.call(this,"input"),this.$el),this.$button=this.sandbox.dom.find(g.call(this,"button"),this.$el),this.sandbox.dom.data(this.$el,"single-internal-link")){var a=this.sandbox.dom.data(this.$el,"single-internal-link");i.call(this,a)}else i.call(this,this.options.preselected);j.call(this),this.URI={str:"",hasChanged:!1},l.call(this),null!==this.data&&o.call(this),k.call(this)},i=function(a){this.data=a,this.sandbox.dom.data(this.$el,"single-internal-link",this.data),a?$("#"+this.options.ids.clearButton).show():$("#"+this.options.ids.clearButton).hide()},j=function(){this.sandbox.on("husky.overlay.single-internal-link."+this.options.instanceName+".initialized",n.bind(this))},k=function(){this.sandbox.dom.on("#"+this.options.ids.clearButton,"click",function(){return this.sandbox.emit("husky.column-navigation."+this.options.instanceName+".unmark",this.data),i.call(this,""),this.$input.val(""),this.sandbox.emit(d.call(this),this.data,this.$el),!1}.bind(this))},l=function(){var a=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,a),this.sandbox.start([{name:"overlay@husky",options:{triggerEl:this.$el,cssClass:"single-internal-overlay",el:a,container:this.$el,removeOnClose:!1,instanceName:"single-internal-link."+this.options.instanceName,skin:"large",slides:[{title:this.sandbox.translate(this.options.translations.overlayTitle),cssClass:"data-source-slide",data:f.data(this.options),contentSpacing:!1,okCallback:m.bind(this)}]}}])},m=function(){this.sandbox.emit("husky.column-navigation."+this.options.instanceName+".get-marked",function(a){Object.keys(a).length>0?(i.call(this,Object.keys(a)[0]),o.call(this),this.sandbox.emit(d.call(this),this.data,this.$el),this.sandbox.emit("husky.overlay.single-internal-link."+this.options.instanceName+".close")):(i.call(this,""),this.$input.val(""),this.sandbox.emit(d.call(this),this.data,this.$el))}.bind(this))},n=function(){var a=this.options.columnNavigationUrl;this.data&&(a=this.options.selectedUrl.replace("{uuid}",this.data)),this.sandbox.start([{name:"column-navigation@husky",options:{el:g.call(this,"columnNavigation"),selected:this.data,url:a,instanceName:this.options.instanceName,resultKey:this.options.resultKey,showOptions:!1,responsive:!1,sortable:!1,hasSubName:"hasChildren",skin:"fixed-height-small",disableIds:this.options.disabledIds,markable:!0,singleMarkable:!0}}])},o=function(){this.sandbox.util.load(p(this.options.url,this.data)).fail(function(){i.call(this)}.bind(this)).then(function(a){this.$input.val((a.title||this.sandbox.translate(this.options.translations.noTitle))+" ("+a.url+")")}.bind(this))},p=function(a,b){return a.replace("{/uuid}",b?"/"+b:"")},q=function(){this.data&&a.add("content",this.data)};return{initialize:function(){this.options=this.sandbox.util.extend({},b,this.options),h.call(this),q.call(this)}}});