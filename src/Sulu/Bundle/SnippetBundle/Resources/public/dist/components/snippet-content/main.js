define([],function(){"use strict";var a={instanceName:null,urlGet:null,idsParameter:"ids",preselected:[],idKey:"id",titleKey:"title",resultKey:"snippets",urlAll:null,language:null,snippetType:null,webspace:null,uniqueSnippets:!0,translations:{noSnippetsSelected:"snippet-content.nosnippets-selected",addSnippets:"snippet-content.add"}},b="sulu.snippets.",c=function(){return d.call(this,"data-changed")},d=function(a){return b+(this.options.instanceName?this.options.instanceName+".":"")+a},e={skeleton:function(a){return['<div class="white-box form-element" id="',a.ids.container,'">','   <div class="header">','       <span class="fa-plus-circle icon left action" id="',a.ids.addButton,'"></span>','       <span class="fa-cog icon right border " id="',a.ids.configButton,'" style="display: none;"></span>',"   </div>",'   <div class="content" id="',a.ids.content,'"></div>',"</div>"].join("")},noContent:function(a){return['<div class="no-content">','   <span class="fa-coffee icon"></span>','   <div class="text">',a,"</div>","</div>"].join("")},data:function(a){return['<div id="',a.ids.snippetList,'"/>'].join("")},contentItem:function(a,b,c){return['<li data-id="',a,'">','   <span class="num">',b,"</span>",'   <span class="value">',c,"</span>",'   <span class="fa-times remove"></span>',"</li>"].join("")}},f=function(a){return"#"+this.options.ids[a]},g=function(){if(this.options.ids={container:"snippet-content-"+this.options.instanceName+"-container",addButton:"snippet-content-"+this.options.instanceName+"-add",configButton:"snippet-content-"+this.options.instanceName+"-config",content:"snippet-content-"+this.options.instanceName+"-content",snippetList:"snippet-content-"+this.options.instanceName+"-column-navigation"},this.sandbox.dom.html(this.$el,e.skeleton(this.options)),this.$container=this.sandbox.dom.find(f.call(this,"container"),this.$el),this.$content=this.sandbox.dom.find(f.call(this,"content"),this.$el),this.$addButton=this.sandbox.dom.find(f.call(this,"addButton"),this.$el),this.$configButton=this.sandbox.dom.find(f.call(this,"configButton"),this.$el),this.sandbox.dom.data(this.$el,"snippets")){var a=this.sandbox.dom.data(this.$el,"snippets");this.data.ids=a.ids}h.call(this),i.call(this),this.URIGet={str:"",hasChanged:!1},this.URIGetAll={str:"",hasChanged:!1},w.call(this),x.call(this),y.call(this),q.call(this),u.call(this),m.call(this)},h=function(){var a=this.sandbox.translate(this.options.translations.noSnippetsSelected);this.sandbox.dom.html(this.$content,e.noContent(a))},i=function(){this.sandbox.on("husky.overlay.snippet-content."+this.options.instanceName+".add.initialized",l.bind(this)),this.sandbox.dom.on(f.call(this,"content"),"click",j.bind(this),"li .remove"),this.sandbox.on("husky.datagrid.view.rendered",function(){this.sandbox.emit("husky.overlay.snippet-content."+this.options.instanceName+".add.set-position")}.bind(this))},j=function(a){var b=this.sandbox.dom.parents(a.currentTarget,"li"),d=this.sandbox.dom.data(b,"id");this.sandbox.dom.remove(b),this.data.ids.splice(this.data.ids.indexOf(d),1),k.call(this,d),t.call(this),0===this.items.length?h.call(this):p.call(this),this.sandbox.emit("husky.column-navigation."+this.options.instanceName+".unmark",d),this.sandbox.emit(c.call(this),this.data,this.$el)},k=function(a){for(var b=-1,c=this.items.length;++b<c;)if(a===this.items[b].id)return this.items.splice(b,1),!0;return!1},l=function(){this.sandbox.start([{name:"datagrid@husky",options:{url:this.URIGetAll.str,preselected:this.data.ids,resultKey:this.options.resultKey,sortable:!1,columnOptionsInstanceName:"",el:f.call(this,"snippetList"),viewOptions:{table:{selectItem:{type:"checkbox"},removeRow:!1,editable:!1,validation:!1,addRowTop:!1,showHead:!0,contentContainer:"#content",highlightSelected:!0}},matchings:[{content:"Title",width:"100%",name:"title",editable:!0,sortable:!0,type:"title",validation:{required:!1}}]}}])},m=function(){this.sandbox.dom.on(this.$el,"click",j.bind(this),".-list .remove")},n=function(){0!==this.items.length?(this.linkList=this.sandbox.dom.createElement('<ul class="items-list"/>'),this.sandbox.util.each(this.items,function(a){o.call(this,this.items[a],this.linkList)}.bind(this)),this.sandbox.dom.html(this.$content,this.linkList),p.call(this)):(h.call(this),t.call(this))},o=function(a,b){this.sandbox.dom.append(b,e.contentItem(a[this.options.idKey],this.sandbox.dom.find("li",b).length+1,a[this.options.titleKey]))},p=function(){this.itemsVisible=this.items.length<this.itemsVisible?this.items.length:this.itemsVisible,(null===this.$footer||void 0===this.$footer)&&(this.$footer=this.sandbox.dom.createElement('<div class="footer"/>')),this.sandbox.dom.append(this.$container,this.$footer)},q=function(){var a=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,a),this.sandbox.start([{name:"overlay@husky",options:{triggerEl:this.$addButton,cssClass:"snippet-content-overlay",el:a,removeOnClose:!1,container:this.$el,instanceName:"snippet-content."+this.options.instanceName+".add",skin:"wide",slides:[{title:this.sandbox.translate(this.options.translations.addSnippets),cssClass:"snippet-content-overlay-add",data:e.data(this.options),okCallback:r.bind(this)}]}}])},r=function(){this.sandbox.emit("husky.datagrid.items.get-selected",function(a){this.data.ids=a,v.call(this,this.data),w.call(this),u.call(this),this.sandbox.emit(c.call(this),this.data,this.$el)}.bind(this))},s=function(){t.call(this);var a=this.sandbox.dom.createElement('<div class="loader"/>');this.sandbox.dom.html(this.$content,a),this.sandbox.start([{name:"loader@husky",options:{el:a,size:"100px",color:"#e4e4e4"}}])},t=function(){null!==this.$footer&&this.sandbox.dom.remove(this.$footer)},u=function(){if(this.URIGet.hasChanged===!0){var a=function(a){if(void 0==a._embedded.snippets)throw"Invalid response from server, expected to find _embedded.snippets";this.items=a._embedded.snippets,n.call(this)}.bind(this);s.call(this),this.data.ids&&this.data.ids.length>0?this.sandbox.util.load(this.URIGet.str).then(a.bind(this)).fail(function(a){this.sandbox.logger.log(a)}.bind(this)):a.call(this,{_embedded:{snippets:[]}})}},v=function(){this.sandbox.dom.data(this.$el,"snippets",this.data)},w=function(){var a=[this.options.urlGet,"?ids=",(this.data.ids||[]).join(","),"&language=",this.options.language].join("");a!==this.URIGet.str?(this.URIGet.str=a,this.URIGet.hasChanged=!0):this.URIGet.hasChanged=!1},x=function(){var a=-1===this.options.urlAll.indexOf("?")?"?":"&",b=[this.options.urlAll,a,"language=",this.options.language,"&type=",this.options.snippetType].join("");b!==this.URIGetAll.str?(this.URIGetAll.str=b,this.URIGetAll.hasChanged=!0):this.URIGetAll.hasChanged=!1},y=function(){this.sandbox.dom.val(f.call(this,"displayOption"),this.data.displayOption)};return{initialize:function(){this.options=this.sandbox.util.extend({},a,this.options),this.data={junk:"junk",ids:[]},this.linkList=null,this.sandbox.util.each(["snippetType","language","webspace","urlGet","urlAll"],function(a){if(null===this.options[a])throw'you must specify the "'+a+'" option'}.bind(this)),g.call(this)}}});