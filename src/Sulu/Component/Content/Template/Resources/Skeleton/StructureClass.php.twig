<?php
use Sulu\Component\Content\Property;
use Sulu\Component\Content\Block\BlockProperty;
use Sulu\Component\Content\PropertyTag;

/**
 * {{ cache_class }}
 *
 * DO NOT EDIT
 * This file is autogenerated by the Sulu Content component
 */
class {{ cache_class }} extends {{ base_class }}
{
    public function __construct()
    {
        parent::__construct('{{ content.key }}', '{{ content.view }}', '{{ content.controller }}', '{{ content.cacheLifetime }}');

{% for property in content.properties %}
{% set counter = 0 %}
{% if property.type == 'block' %}
{% set parent = '$prop1' %}
        {{ parent }} = {{ _self.complextype(property) }};
        $this->add({{ parent }});
{{ _self.constructProperties(property.properties, counter, parent) }}
{% else %}
        $this->add(
{{ _self.basictype(property) }}
        );
{% endif %}
{% endfor %}
    }
}

{% macro constructProperties(properties, counter, parent) %}
{% for prop in properties %}
{% set counter = counter+1 %}
{% if prop.type == 'block' %}
{% set child = '$prop' ~ counter %}
        {{ child }} = {{ _self.complextype(prop) }};
        {{ parent }}->addChild({{ child }});
{{ _self.constructProperties(prop.properties, counter, child) }}
{% else %}
        {{ parent }}->addChild(
{{ _self.basictype(prop) }}
        );
{% endif %}
{% endfor %}
{% endmacro %}

{% macro complextype(property) %}
new BlockProperty(
            '{{ property.name }}',
            '{{ property.title }}',
            {{ property.mandatory is defined and property.mandatory ? 'true' : 'false' }},
            {{ property.multilingual is defined ? (property.multilingual? 'true':'false') : 'true' }},
            {{ property.maxOccurs is defined ? property.maxOccurs : 1 }},
            {{ property.minOccurs is defined ? property.minOccurs : 1 }},
            {{ 'array(' }}
            {% for param in property.params %}
                '{{ param.name }}' => '{{ param.value }}',
            {% endfor %}
            {{ ')' }},
            {{ 'array(' }}
{% for tag in property.tags %}
                '{{ tag.name }}' => new PropertyTag('{{ tag.name }}', {{ tag.priority is defined and tag.priority ? tag.priority : '1' }}),
{% endfor %}
            {{ ')' }}
        ){% endmacro %}

{% macro basictype(property) %}
            new Property(
                '{{ property.name }}',
                '{{ property.title }}',
                '{{ property.type }}',
                {{ property.mandatory is defined and property.mandatory ? 'true' : 'false' }},
                {{ property.multilingual is defined ? (property.multilingual? 'true':'false') : 'true' }},
                {{ property.maxOccurs is defined ? property.maxOccurs : 1 }},
                {{ property.minOccurs is defined ? property.minOccurs : 1 }},
                {{ 'array(' }}
{% for param in property.params %}
                    '{{ param.name }}' => '{{ param.value }}',
{% endfor %}
                {{ ')' }},
                {{ 'array(' }}
{% for tag in property.tags %}
                    '{{ tag.name }}' => new PropertyTag('{{ tag.name }}', {{ tag.priority is defined and tag.priority ? tag.priority : '1' }}),
{% endfor %}
                {{ ')' }}
            ){% endmacro %}
