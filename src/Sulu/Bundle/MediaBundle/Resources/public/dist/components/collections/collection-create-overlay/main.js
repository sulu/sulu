define(["services/sulumedia/collection-manager","services/sulumedia/user-settings-manager","services/husky/mediator"],function(a,b,c){"use strict";var d="sulu.collection-add.",e={parent:null,instanceName:""},f={newFormSelector:"#collection-new"},g=function(){return i.call(this,"closed")},h=function(){return i.call(this,"initialized")},i=function(a){return d+(this.options.instanceName?this.options.instanceName+".":"")+a};return{templates:["/admin/media/template/collection/new"],initialize:function(){this.options=this.sandbox.util.extend(!0,{},e,this.options),this.openOverlay(),this.sandbox.emit(h.call(this))},openOverlay:function(){var a=this.sandbox.dom.createElement('<div class="overlay-element"/>');this.sandbox.dom.append(this.$el,a),this.sandbox.once("husky.overlay.add-collection.opened",function(){this.sandbox.start(f.newFormSelector),this.sandbox.form.create(f.newFormSelector),$(f.newFormSelector+" input").first().focus()}.bind(this)),this.sandbox.start([{name:"overlay@husky",options:{el:a,title:this.sandbox.translate("sulu.media.add-collection"),instanceName:"add-collection",data:this.renderTemplate("/admin/media/template/collection/new"),okCallback:this.okCallback.bind(this),cancelCallback:function(){this.sandbox.stop()}.bind(this),openOnStart:!0,removeOnClose:!0,propagateEvents:!1}}])},okCallback:function(){return this.sandbox.form.validate(f.newFormSelector)?(this.addCollection(),void this.sandbox.stop()):!1},addCollection:function(){var d=this.sandbox.form.getData(f.newFormSelector);d.parent=this.options.parent,d.locale=b.getMediaLocale(),a.save(d).done(function(a){c.emit("sulu.media.collection-create.created",a)}.bind(this))},destroy:function(){this.sandbox.emit(g.call(this))}}});