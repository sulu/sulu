define([],function(){"use strict";var a={visibleItems:5,dataSource:"",subFoldersDisabled:!1,categories:[],preSelectedCategory:null,tags:[],tagsDisabled:!1,tagsAutoCompleteUrl:"",tagsGetParameter:"search",preSelectedTagOperator:"or",sortBy:[],preSelectedSortBy:null,preSelectedSortMethod:"asc",presentAs:[],preSelectedPresentAs:null,limitResult:null,instanceName:"undefined",url:"",dataSourceParameter:"dataSource",includeSubFolders:!1,includeSubFoldersParameter:"includeSubFolders",categoryParameter:"category",tagsParameter:"tags",tagOperatorParameter:"tagOperator",sortByParameter:"sortBy",sortMethodParameter:"sortMethod",presentAsParameter:"presentAs",limitResultParameter:"limitResult",limitResultDisabled:!1,idKey:"id",resultKey:"items",tagsResultKey:"tags",columnNavigationResultKey:"nodes",titleKey:"title",pathKey:"path",translations:{},elementDataName:"smart-content",externalConfigs:!1,columnNavigationUrl:"",hideDataSource:!1,hideCategories:!1,hideTags:!1,hideSortBy:!1,hideLimit:!1,title:"Smart-Content"},b={asc:"Ascending",desc:"Descanding"},c={or:"or",and:"and"},d={containerSelector:".smart-content-container",headerSelector:".header",contentSelector:".content",sourceSelector:".source",footerClass:"footer",viewTogglerClass:"view-toggler",buttonIcon:"fa-filter",includeSubSelector:".includeSubCheck",categoryDDClass:"category-dropdown",tagListClass:"tag-list",tagOperatorClass:"tag-list-operator-dropdown",sortByDDClass:"sort-by-dropdown",sortMethodDDClass:"sort-method-dropdown",presentAsDDClass:"present-as-dropdown",limitToSelector:".limit-to",dataSourceSelector:".data-source",contentListClass:"items-list",loaderClass:"loader"},e={skeleton:['<div class="white-box smart-content-container form-element">','<div class="header"></div>','<div class="content"></div>',"</div>"].join(""),source:['<span class="text">','<span class="source">','<span class="desc"><%= desc %></span>','<span class="val"><%= val %></span>',"</span>","</span>"].join(""),noContent:['<div class="no-content">','<span class="fa-coffee icon"></span>','<div class="text"><%= noContentStr %></div>',"</div>"].join(""),contentItem:['<li data-id="<%= dataId %>">','<span class="num"><%= num %></span>','<span class="value"><%= value %></span>',"</li>"].join(""),overlayContent:{main:['<div class="smart-overlay-content">',"</div>"].join(""),dataSource:['<div class="item-half left">','<span class="desc"><%= dataSourceLabelStr %></span>','<div class="btn action fit" id="select-data-source-action"><%= dataSourceButtonStr %></div>','<div><span class="sublabel"><%= dataSourceLabelStr %>:</span> <span class="sublabel data-source"><%= dataSourceValStr %></span></div>',"</div>"].join(""),subFolders:['<div class="item-half">','<div class="check<%= disabled %>">',"<label>",'<div class="custom-checkbox">','<input type="checkbox" class="includeSubCheck form-element"<%= includeSubCheckedStr %>/>','<span class="icon"></span>',"</div>",'<span class="description"><%= includeSubStr %></span>',"</label>","</div>","</div>"].join(""),categories:['<div class="item full">','<span class="desc"><%= filterByCatStr %></span>','<div class="'+d.categoryDDClass+'"></div>',"</div>"].join(""),tagList:['<div class="item-half left tags<%= disabled %>">','<span class="desc"><%= filterByTagsStr %></span>','<div class="'+d.tagListClass+'"></div>',"</div>"].join(""),tagOperator:['<div class="item-half<%= disabled %>">','<span class="desc">&nbsp;</span>','<div class="'+d.tagOperatorClass+'"></div>',"</div>"].join(""),sortBy:['<div class="item-half left">','<span class="desc"><%= sortByStr %></span>','<div class="'+d.sortByDDClass+'"></div>',"</div>"].join(""),sortMethod:['<div class="item-half">','<span class="desc">&nbsp;</span>','<div class="'+d.sortMethodDDClass+'"></div>',"</div>"].join(""),presentAs:['<div class="item-half left">','<span class="desc"><%= presentAsStr %></span>','<div class="'+d.presentAsDDClass+'"></div>',"</div>"].join(""),limitResult:['<div class="item-half">','<span class="desc"><%= limitResultToStr %></span>','<input type="text" value="<%= limitResult %>" class="limit-to form-element"<%= disabled %>/>',"</div>"].join("")}},f="husky.smart-content.",g=function(){return n.call(this,"initialize")},h=function(){return n.call(this,"input-retrieved")},i=function(){return n.call(this,"data-request")},j=function(){return n.call(this,"data-retrieved")},k=function(){return n.call(this,"data-changed")},l=function(){return n.call(this,"external-configs")},m=function(){return n.call(this,"set-configs")},n=function(a){return f+(this.options.instanceName?this.options.instanceName+".":"")+a};return{initialize:function(){this.sandbox.logger.log("initialize",this),this.options=this.sandbox.util.extend(!0,{},a,this.options),this.options.externalConfigs===!0?this.sandbox.on(l.call(this),function(a){this.options=this.sandbox.util.extend(!0,{},this.options,a),this.createComponent()}.bind(this)):this.createComponent()},createComponent:function(){this.setVariables(),this.render(),this.renderStartContent(),this.startOverlay(),this.bindEvents(),this.setURI(),this.loadContent(),this.setElementData(this.overlayData),this.sandbox.emit(g.call(this))},setVariables:function(){this.$container=null,this.$header=null,this.$content=null,this.$footer=null,this.$button=null,this.itemsVisible=this.options.visibleItems,this.items=[],this.URI={str:"",hasChanged:!1},this.initOverlayData(),this.translations={noContentFound:"smart-content.nocontent-found",noContentSelected:"smart-content.nocontent-selected",visible:"smart-content.visible",of:"smart-content.of",configureSmartContent:"smart-content.configure-smart-content",dataSourceLabel:"smart-content.data-source.label",dataSourceButton:"smart-content.data-source.button",includeSubFolders:"smart-content.include-sub-folders",filterByCategory:"smart-content.filter-by-category",filterByTags:"smart-content.filter-by-tags",useAnyTag:"smart-content.use-any-tag",useAllTags:"smart-content.use-all-tags",sortBy:"smart-content.sort-by",noSorting:"smart-content.no-sorting",ascending:"smart-content.ascending",descending:"smart-content.descending",presentAs:"smart-content.present-as",limitResultTo:"smart-content.limit-result-to",noCategory:"smart-content.no-category",choosePresentAs:"smart-content.choose-present-as",from:"smart-content.from",subFoldersInclusive:"smart-content.sub-folders-inclusive",viewAll:"smart-content.view-all",viewLess:"smart-content.view-less",chooseDataSource:"smart-content.choose-data-source",chooseDataSourceOk:"smart-content.choose-data-source.ok",chooseDataSourceCancel:"smart-content.choose-data-source.cancel"},this.translations=this.sandbox.util.extend(!0,{},this.translations,this.options.translations)},initOverlayData:function(){this.$overlayContent=null,this.overlayData={dataSource:this.options.dataSource,includeSubFolders:this.options.includeSubFolders,category:this.options.preSelectedCategory,tags:this.options.tags,tagOperator:this.options.preSelectedTagOperator,sortBy:this.options.preSelectedSortBy,sortMethod:this.options.preSelectedSortMethod,presentAs:this.options.preSelectedPresentAs,limitResult:this.options.limitResult},this.overlayDisabled={categories:0===this.options.categories.length,sortBy:0===this.options.sortBy.length,presentAs:0===this.options.presentAs.length,subFolders:this.options.subFoldersDisabled,tags:this.options.tagsDisabled,limitResult:this.options.limitResultDisabled}},render:function(){this.renderContainer(),this.renderHeader()},renderContainer:function(){this.sandbox.dom.html(this.$el,e.skeleton),this.$container=this.sandbox.dom.find(d.containerSelector,this.$el)},renderHeader:function(){this.$header=this.sandbox.dom.find(d.headerSelector,this.$el),this.$header.length?this.renderButton():this.sandbox.logger.log("Error: no Header-container found!")},insertSource:function(){var a,b=this.sandbox.dom.find(d.dataSourceSelector,this.$overlayContent);this.sandbox.dom.text(b,this.sandbox.util.cropMiddle(this.overlayData.path,30,"...")),"undefined"!=typeof this.overlayData.dataSource&&(a=this.sandbox.translate(this.translations.from),a+=this.overlayData.includeSubFolders!==!1?" ("+this.sandbox.translate(this.translations.subFoldersInclusive)+"):":": ",this.sandbox.dom.append(this.$header,this.sandbox.util.template(e.source)({desc:a,val:this.overlayData.title})))},removeSource:function(){this.sandbox.dom.remove(this.sandbox.dom.find(d.sourceSelector,this.$header))},renderButton:function(){this.$button=this.sandbox.dom.createElement('<span class="icon right border"/>'),this.sandbox.dom.prependClass(this.$button,d.buttonIcon),this.sandbox.dom.append(this.$header,this.$button)},initContentContainer:function(){null===this.$content&&(this.$content=this.sandbox.dom.find(d.contentSelector,this.$el))},renderContent:function(){if(this.initContentContainer(),0!==this.items.length){var a,b=-1,c=this.items.length;for(a=this.sandbox.dom.createElement('<ul class="'+d.contentListClass+'"/>');++b<c&&b<this.itemsVisible;)this.sandbox.dom.append(a,_.template(e.contentItem)({dataId:this.items[b][this.options.idKey],value:this.items[b][this.options.titleKey],num:b+1}));this.sandbox.dom.html(this.$content,a),this.renderFooter()}else this.sandbox.dom.html(this.$content,_.template(e.noContent)({noContentStr:this.sandbox.translate(this.translations.noContentSelected)})),this.detachFooter()},renderStartContent:function(){this.initContentContainer(),this.sandbox.dom.html(this.$content,_.template(e.noContent)({noContentStr:this.sandbox.translate(this.translations.noContentSelected)}))},renderFooter:function(){this.itemsVisible=this.items.length<this.itemsVisible?this.items.length:this.itemsVisible,null===this.$footer&&(this.$footer=this.sandbox.dom.createElement("<div/>"),this.sandbox.dom.addClass(this.$footer,d.footerClass)),this.sandbox.dom.html(this.$footer,["<span>","<strong>"+this.itemsVisible+" </strong>",this.sandbox.translate(this.translations.of)," ","<strong>"+this.items.length+" </strong>",this.sandbox.translate(this.translations.visible),"</span>"].join("")),this.appendViewToggler(),this.sandbox.dom.append(this.$container,this.$footer),this.bindFooterEvents()},appendViewToggler:function(){this.itemsVisible<this.items.length?this.sandbox.dom.append(this.$footer,'<span class="'+d.viewTogglerClass+'">('+this.sandbox.translate(this.translations.viewAll)+")</span>"):this.items.length>this.options.visibleItems&&this.sandbox.dom.append(this.$footer,'<span class="'+d.viewTogglerClass+'">('+this.sandbox.translate(this.translations.viewLess)+")</span>")},detachFooter:function(){null!==this.$footer&&this.sandbox.dom.remove(this.$footer)},bindEvents:function(){this.sandbox.on(j.call(this),function(){this.renderContent(),this.removeSource(),this.insertSource()}.bind(this)),this.sandbox.on(h.call(this),function(){this.setURI(),this.loadContent()}.bind(this)),this.sandbox.on("husky.overlay.smart-content."+this.options.instanceName+".initialized",function(){this.startOverlayComponents()}.bind(this)),this.sandbox.on(m.call(this),function(a){this.options=this.sandbox.util.extend(!1,{},this.options,a),this.sandbox.emit("husky.overlay.smart-content."+this.options.instanceName+".remove"),this.initOverlayData(),this.startOverlay(),this.setURI(),this.loadContent()}.bind(this))},bindFooterEvents:function(){this.sandbox.dom.on(this.sandbox.dom.find("."+d.viewTogglerClass,this.$footer),"click",function(){this.toggleView()}.bind(this))},startLoader:function(){this.detachFooter();var a=this.sandbox.dom.createElement('<div class="'+d.loaderClass+'"/>');this.sandbox.dom.html(this.$content,a),this.sandbox.start([{name:"loader@husky",options:{el:a,size:"100px",color:"#e4e4e4"}}])},toggleView:function(){this.itemsVisible<this.items.length?this.itemsVisible=this.items.length:this.itemsVisible=this.options.visibleItems,this.renderContent()},startOverlay:function(){this.initOverlayContent();var a=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,a),this.sandbox.start([{name:"overlay@husky",options:{triggerEl:this.$button,el:a,removeOnClose:!1,container:this.$el,instanceName:"smart-content."+this.options.instanceName,skin:"wide",slides:[{title:this.sandbox.translate(this.translations.configureSmartContent).replace("{title}",this.options.title),data:this.$overlayContent,okCallback:function(){this.itemsVisible=this.options.visibleItems,this.getOverlayData()}.bind(this)},{title:this.sandbox.translate(this.translations.chooseDataSource),data:'<div id="column-navigation-'+this.options.instanceName+'"/>',cssClass:"column-navigation-slide",okInactive:!0,okDefaultText:this.sandbox.translate(this.translations.chooseDataSourceOk),cancelDefaultText:this.sandbox.translate(this.translations.chooseDataSourceCancel),buttons:[{type:"cancel",inactive:!1,align:"center"}],cancelCallback:function(){return this.sandbox.emit("husky.overlay.smart-content."+this.options.instanceName+".slide-left"),!1}.bind(this)}]}}]),this.bindColumnNavigationEvents()},bindColumnNavigationEvents:function(){this.sandbox.on("husky.overlay.smart-content."+this.options.instanceName+".initialized",this.initColumnNavigation.bind(this)),this.sandbox.once("husky.overlay.smart-content."+this.options.instanceName+".opened",function(){var a=this.sandbox.dom.outerHeight(".smart-content-overlay .slide-0 .overlay-content")+24;this.sandbox.dom.css(".smart-content-overlay .slide-1 .overlay-content","height",a+"px")}.bind(this)),this.sandbox.on("husky.column-navigation.smart-content"+this.options.instanceName+".action",function(a){this.sandbox.emit("husky.overlay.smart-content."+this.options.instanceName+".slide-left");var b=this.sandbox.dom.find(d.dataSourceSelector,this.$overlayContent);this.overlayData.dataSource=a.id,this.sandbox.dom.text(b,this.sandbox.util.cropMiddle(a.path,30,"...")),this.sandbox.dom.data(b,"id",a.id)}.bind(this)),this.sandbox.dom.on(this.$el,"click",function(){this.sandbox.emit("husky.overlay.smart-content."+this.options.instanceName+".slide-right")}.bind(this),"#select-data-source-action")},initColumnNavigation:function(){var a=this.options.columnNavigationUrl.replace("{/dataSource}",this.overlayData.dataSource?"/"+this.overlayData.dataSource:"");this.sandbox.start([{name:"column-navigation@husky",options:{el:"#column-navigation-"+this.options.instanceName,url:a,selected:this.overlayData.dataSource,instanceName:"smart-content"+this.options.instanceName,responsive:!1,actionIcon:"fa-check",showOptions:!1,sortable:!1,showStatus:!1,resultKey:this.options.columnNavigationResultKey}}])},initOverlayContent:function(){this.$overlayContent=this.sandbox.dom.createElement(_.template(e.overlayContent.main)()),this.options.hideDataSource||(this.$overlayContent.append(_.template(e.overlayContent.dataSource)({dataSourceLabelStr:this.sandbox.translate(this.translations.dataSourceLabel),dataSourceButtonStr:this.sandbox.translate(this.translations.dataSourceButton),dataSourceValStr:this.options.dataSource.path})),this.$overlayContent.append(_.template(e.overlayContent.subFolders)({includeSubStr:this.sandbox.translate(this.translations.includeSubFolders),includeSubCheckedStr:this.options.includeSubFolders?" checked":"",disabled:this.overlayDisabled.subFolders?" disabled":""})),this.$overlayContent.append('<div class="clear"></div>')),this.options.hideCategories||this.$overlayContent.append(_.template(e.overlayContent.categories)({filterByCatStr:this.sandbox.translate(this.translations.filterByCasrc/Sulu/Bundle/ContentBundle/Tests/Functional/Content/SmartContentQueryBuilderTest.phptegory)})),this.options.hideTags||(this.$overlayContent.append(_.template(e.overlayContent.tagList)({filterByTagsStr:this.sandbox.translate(this.translations.filterByTags),disabled:this.overlayDisabled.tags?" disabled":""})),this.$overlayContent.append(_.template(e.overlayContent.tagOperator)({disabled:this.overlayDisabled.tags?" disabled":""})),this.$overlayContent.append('<div class="clear"></div>')),this.options.hideSortBy||(this.$overlayContent.append(_.template(e.overlayContent.sortBy)({sortByStr:this.sandbox.translate(this.translations.sortBy)})),this.$overlayContent.append(_.template(e.overlayContent.sortMethod)())),this.$overlayContent.append('<div class="clear"></div>'),this.options.presentAs&&this.options.presentAs.length>0&&this.$overlayContent.append(_.template(e.overlayContent.presentAs)({presentAsStr:this.sandbox.translate(this.translations.presentAs)})),this.options.hideLimit||this.$overlayContent.append(_.template(e.overlayContent.limitResult)({limitResultToStr:this.sandbox.translate(this.translations.limitResultTo),limitResult:this.options.limitResult>0?this.options.limitResult:"",disabled:this.overlayDisabled.limitResult?" disabled":""})),this.$overlayContent.append('<div class="clear"></div>')},startOverlayComponents:function(){this.sandbox.start([{name:"select@husky",options:{el:this.sandbox.dom.find("."+d.categoryDDClass,this.$overlayContent),instanceName:this.options.instanceName+d.categoryDDClass,defaultLabel:this.sandbox.translate(this.translations.noCategory),value:"name",data:this.options.categories,preSelectedElements:[this.options.preSelectedCategory],disabled:this.overlayDisabled.categories}},{name:"auto-complete-list@husky",options:{el:this.sandbox.dom.find("."+d.tagListClass,this.$overlayContent),instanceName:this.options.instanceName+d.tagListClass,items:this.options.tags,remoteUrl:this.options.tagsAutoCompleteUrl,autocomplete:""!==this.options.tagsAutoCompleteUrl,getParameter:this.options.tagsGetParameter,noNewTags:!0,itemsKey:this.options.tagsResultKey,disabled:this.overlayDisabled.tags}},{name:"select@husky",options:{el:this.sandbox.dom.find("."+d.tagOperatorClass,this.$overlayContent),instanceName:this.options.instanceName+d.tagOperatorClass,value:"name",data:[{id:c.or,name:this.sandbox.translate(this.translations.useAnyTag)},{id:c.and,name:this.sandbox.translate(this.translations.useAllTags)}],preSelectedElements:[c[this.options.preSelectedTagOperator]],disabled:this.overlayDisabled.tags}},{name:"select@husky",options:{el:this.sandbox.dom.find("."+d.sortByDDClass,this.$overlayContent),instanceName:this.options.instanceName+d.sortByDDClass,value:"name",data:this.options.sortBy,preSelectedElements:[this.options.preSelectedSortBy],disabled:this.overlayDisabled.sortBy,defaultLabel:this.sandbox.translate("smart-content.no-sorting"),deselectField:this.sandbox.translate("smart-content.no-sorting")}},{name:"select@husky",options:{el:this.sandbox.dom.find("."+d.sortMethodDDClass,this.$overlayContent),instanceName:this.options.instanceName+d.sortMethodDDClass,value:"name",data:[{id:b.asc,name:this.sandbox.translate(this.translations.ascending)},{id:b.desc,name:this.sandbox.translate(this.translations.descending)}],preSelectedElements:[b[this.options.preSelectedSortMethod]],disabled:this.overlayDisabled.sortBy}},{name:"select@husky",options:{el:this.sandbox.dom.find("."+d.presentAsDDClass,this.$overlayContent),instanceName:this.options.instanceName+d.presentAsDDClass,defaultLabel:this.sandbox.translate(this.translations.choosePresentAs),value:"name",data:this.options.presentAs,preSelectedElements:[this.options.preSelectedPresentAs],disabled:this.overlayDisabled.presentAs}}])},setURI:function(){var a=-1===this.options.url.indexOf("?")?"?":"&",b=[this.options.url,a,this.options.dataSourceParameter,"=",this.overlayData.dataSource,"&",this.options.includeSubFoldersParameter,"=",this.overlayData.includeSubFolders,"&",this.options.categoryParameter,"=",this.overlayData.category,"&",this.options.tagsParameter,"=",this.overlayData.tags,"&",this.options.tagOperatorParameter,"=",this.overlayData.tagOperator,"&",this.options.sortByParameter,"=",this.overlayData.sortBy,"&",this.options.sortMethodParameter,"=",this.overlayData.sortMethod,"&",this.options.presentAsParameter,"=",this.overlayData.presentAs,"&",this.options.limitResultParameter,"=",this.overlayData.limitResult].join("");this.overlayData.dataSource.length>0&&b!==this.URI.str?(this.sandbox.emit(k.call(this),this.sandbox.dom.data(this.$el,"smart-content"),this.$el),this.URI.str=b,this.URI.hasChanged=!0):this.URI.hasChanged=!1},loadContent:function(){this.URI.hasChanged===!0&&(this.sandbox.emit(i.call(this)),this.startLoader(),this.sandbox.util.ajax({url:this.URI.str,success:function(a){this.overlayData.title=a[this.options.titleKey],this.overlayData.path=a[this.options.pathKey]||"/",this.items=a._embedded[this.options.resultKey],this.sandbox.emit(j.call(this))}.bind(this),error:function(a){this.sandbox.logger.log(a)}.bind(this)}))},getOverlayData:function(){var a,e,f,g,i,j,k;a=e=f=g=i=j=this.sandbox.data.deferred(),this.overlayData.includeSubFolders=this.sandbox.dom.prop(this.sandbox.dom.find(d.includeSubSelector,this.$overlayContent),"checked"),this.overlayData.limitResult=this.sandbox.dom.val(this.sandbox.dom.find(d.limitToSelector,this.$overlayContent)),k=this.sandbox.dom.data(this.sandbox.dom.find(d.dataSourceSelector,this.$overlayContent),"id"),void 0!==k&&(this.overlayData.dataSource=k),this.sandbox.emit("husky.select."+this.options.instanceName+d.categoryDDClass+".get-checked",function(b){this.overlayData.category=b,a.resolve()}.bind(this)),this.sandbox.emit("husky.auto-complete-list."+this.options.instanceName+d.tagListClass+".get-tags",function(a){this.overlayData.tags=a,e.resolve()}.bind(this)),this.sandbox.emit("husky.select."+this.options.instanceName+d.tagOperatorClass+".get-checked",function(a){this.overlayData.tagOperator=a[0]===c.and?c.and:c.or,f.resolve()}.bind(this)),this.sandbox.emit("husky.select."+this.options.instanceName+d.sortByDDClass+".get-checked",function(a){this.overlayData.sortBy=a,g.resolve()}.bind(this)),this.sandbox.emit("husky.select."+this.options.instanceName+d.sortMethodDDClass+".get-checked",function(a){this.overlayData.sortMethod=a[0]===b.asc?"asc":"desc",i.resolve()}.bind(this)),this.sandbox.emit("husky.select."+this.options.instanceName+d.presentAsDDClass+".get-checked",function(a){1===a.length?this.overlayData.presentAs=a[0]:this.overlayData.presentAs=null,j.resolve()}.bind(this)),this.sandbox.dom.when(a.promise(),e.promise(),f.promise(),g.promise(),i.promise(),j.promise()).then(function(){this.setElementData(this.overlayData),this.sandbox.emit(h.call(this))}.bind(this))},setElementData:function(a){var b=this.sandbox.util.extend(!0,{},a);this.sandbox.dom.data(this.$el,this.options.elementDataName,b)}}});