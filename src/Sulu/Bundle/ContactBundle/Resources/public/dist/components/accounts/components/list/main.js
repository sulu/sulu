define(["mvc/relationalstore","app-config"],function(a,b){"use strict";var c=function(){this.sandbox.on("husky.datagrid.item.click",function(a){this.sandbox.emit("sulu.sidebar.set-widget","/admin/widget-groups/account-info?account="+a)},this),this.sandbox.on("sulu.list-toolbar.delete",function(){this.sandbox.emit("husky.datagrid.items.get-selected",function(a){this.sandbox.emit("sulu.contacts.accounts.delete",a)}.bind(this))},this),this.sandbox.on("sulu.list-toolbar.add",function(){this.sandbox.emit("sulu.contacts.accounts.new")},this)},d="",e=function(){var a,c,e,g,h,i,j,k=b.getSection("sulu-contact");if(!k||!k.hasOwnProperty("accountTypes")||k.accountTypes.length<1)return!1;h=k.accountTypes,a=[{id:"all",title:this.sandbox.translate("public.all")}];for(e in h)"basic"!==e&&(g=h[e],a.push({id:parseInt(g.id,10),name:g.name,title:this.sandbox.translate(g.translation)}));if(this.options.accountType){for(c in h)if(c.toLowerCase()===this.options.accountType.toLowerCase()){i=h[c];break}if(!i)throw"accountType "+i+" does not exist!";d+="&type="+i.id}return j=i?parseInt(i.id,10)+1:!1,{callback:f.bind(this),preselector:"position",data:{items:a},preselect:j}},f=function(a){var b=null;"all"!==a.id&&(b=a.id),this.sandbox.emit("husky.datagrid.url.update",{type:b}),this.sandbox.emit("sulu.contacts.accounts.list",a.name,!0)},g=function(a){this.sandbox.emit("sulu.contacts.accounts.new",a)};return{view:!0,layout:{content:{width:"max",leftSpace:!1,rightSpace:!1},sidebar:{width:"fixed",cssClasses:"sidebar-padding-50"}},header:function(){var a=!1,b=e.call(this);return b&&(a={fullControl:!0,options:b}),{title:"contact.accounts.title",noBack:!0,tabs:a,breadcrumb:[{title:"navigation.contacts"},{title:"contact.accounts.title"}]}},templates:["/admin/contact/template/account/list"],initialize:function(){this.render(),c.call(this)},render:function(){a.reset(),this.sandbox.dom.html(this.$el,this.renderTemplate("/admin/contact/template/account/list"));var c,d,e="",f=b.getSection("sulu-contact").accountTypes,h={};for(c in f)h[f[c].id]=f[c],this.options.accountType&&c.toLowerCase()===this.options.accountType.toLowerCase()&&(d=f[c]);if(this.options.accountType){if(!d)throw"accountType "+d+" does not exist!";e+="&type="+d.id}this.sandbox.sulu.initListToolbarAndList.call(this,"accounts","/admin/api/accounts/fields",{el:this.$find("#list-toolbar-container"),instanceName:"accounts",parentTemplate:"default",inHeader:!0,template:function(){return[{id:"add",icon:"plus-circle","class":"highlight-white",position:1,title:this.sandbox.translate("sulu.list-toolbar.add"),items:[{id:"add-basic",title:this.sandbox.translate("contact.account.add-basic"),callback:g.bind(this,"basic")},{id:"add-lead",title:this.sandbox.translate("contact.account.add-lead"),callback:g.bind(this,"lead")},{id:"add-customer",title:this.sandbox.translate("contact.account.add-customer"),callback:g.bind(this,"customer")},{id:"add-supplier",title:this.sandbox.translate("contact.account.add-supplier"),callback:g.bind(this,"supplier")}],callback:function(){this.sandbox.emit("sulu.list-toolbar.add")}.bind(this)}]}},{el:this.sandbox.dom.find("#companies-list",this.$el),url:"/admin/api/accounts?flat=true"+e,resultKey:"accounts",searchInstanceName:"accounts",searchFields:["name"],contentFilters:{type:function(a){return a?this.sandbox.translate(h[a].translation):""}.bind(this)},viewOptions:{table:{icons:[{icon:"pencil",column:"name",align:"left",callback:function(a){this.sandbox.emit("sulu.contacts.accounts.load",a)}.bind(this)}],highlightSelected:!0,fullWidth:!0}}})}}});